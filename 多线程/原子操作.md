# 原子操作（Atomic Operation）

## 原子操作的基本概念

不可分割性：原子操作是不可分割的，即操作要么完全执行成功，要么完全不执行。中间状态对其他线程不可见，这意味着在操作进行期间，不会发生上下文切换，也不会被其他线程打断。

线程安全：由于原子操作本身保证了执行过程中的不可分割性，所以在多线程环境下，原子操作是线程安全的，不需要使用额外的锁或同步机制。

## 常见的原子操作

读写操作：在硬件支持的情况下，某些基本的数据类型（如整数或指针）的读写操作可以是原子的。例如，在大多数平台上，对32位或64位整数的读取和写入是原子操作。

原子自增/自减：如atomic_increment、atomic_decrement，用于对某个变量进行原子的加一或减一操作。这在计数器、引用计数等场景中非常有用。

比较并交换（Compare-and-Swap, CAS）：这是最常见的原子操作之一，它比较某个内存位置的值是否为预期值，如果是，则将其更新为新值；否则，不做任何操作。CAS操作是实现无锁算法的基础。

交换（Exchange）：原子交换操作将某个变量的值设置为新值，并返回该变量的旧值。这也是常用的同步原子操作。

## 原子操作的应用场景

无锁编程：原子操作是无锁编程的基础。在高并发环境中，无锁数据结构（如[无锁队列、无锁栈](./无锁队列和无锁栈.py)）可以通过原子操作来实现，避免了锁带来的开销和死锁风险。

计数器和累加器：在多线程环境中，原子操作可以安全地实现计数器或累加器。例如，多个线程同时递增一个共享变量时，使用原子操作可以确保结果正确。

引用计数：原子操作常用于智能指针的引用计数中，以保证引用计数的递增和递减操作是线程安全的。
