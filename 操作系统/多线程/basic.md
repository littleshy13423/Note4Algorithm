# 多线程

## 基本概念

### 进程（Process）

进程是操作系统分配资源的基本单位，每个进程都有独立的内存空间和资源环境。一个程序启动后，操作系统会创建一个进程来运行该程序，进程之间是相互独立的，通常无法直接访问彼此的内存空间。

#### 进程的特性

独立性：进程之间的内存空间相互独立，操作系统为每个进程分配独立的地址空间。
资源重载：进程切换时，操作系统需要切换内存地址空间、寄存器状态等，代价较大。
并发性：多个进程可以并发运行，多个进程间通过进程间通信（IPC）进行数据交换，如管道、消息队列、共享内存等。
隔离性：由于进程之间互相独立，程序的崩溃不会影响其他进程的运行，安全性较高。

### 什么是线程（Thread）？

线程是操作系统调度的最小单位。一个进程可以包含多个线程，它们共享进程的资源（如内存、文件句柄）。进程是资源分配的基本单位，具有独立的内存空间。多个线程共享进程的[内存空间](./内存空间.md)，而进程之间的内存是独立的。线程切换比进程切换更轻量级，因为线程之间共享同一地址空间，而进程切换涉及更复杂的上下文切换。

### 什么是协程（Coroutine）？

协程是一种更加轻量级的线程，可以在单个线程内实现多任务的调度和切换。与线程相比，协程是由程序自身控制的，而不是由操作系统内核控制，因此切换开销极小。

#### 协程的特性

协作式调度：协程的切换由程序显式控制（如通过yield或await），而不是由操作系统抢占式调度。协程只有在需要时才会主动让出控制权，因此避免了线程切换带来的上下文切换开销。
轻量级：协程的创建和切换成本非常低，可以在单个线程中创建大量协程。协程共享线程的栈空间，但每个协程有独立的执行状态（如程序计数器）。
单线程并发：协程通常运行在单个线程中，因此不需要考虑线程间的竞争和同步问题。这简化了编写高效并发代码的难度。
非阻塞I/O：协程通常用于异步编程和非阻塞I/O操作中，它允许在等待I/O操作完成时切换到其他任务，提高程序的并发性。
