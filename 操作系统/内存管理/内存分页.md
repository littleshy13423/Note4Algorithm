# 内存分页

## 内存分页的基本概念

虚拟内存被分割成固定大小的块，称为页（通常是4KB）。物理内存也被分割成与页相同大小的块，称为页框。每个进程都有一个页表，记录了虚拟页与物理页框的映射关系。

## 分页的工作原理

当进程访问内存时，CPU使用虚拟地址，而虚拟地址需要转换为物理地址才能实际访问内存。分页机制将这个过程分为两步：

虚拟地址分解：

虚拟地址由页号和页内偏移量组成。页号用于查找页表，页内偏移量用于定位页框内的具体位置。

地址转换：

根据虚拟地址中的页号，查找页表，获取对应的物理页框号。将物理页框号与虚拟地址中的页内偏移量组合，形成物理地址。通过生成的物理地址访问内存中的数据。

## 分页的优点

内存隔离：不同进程的虚拟内存空间相互独立，分页机制确保了进程之间的内存隔离。
简化内存管理：分页消除了外部碎片问题，因为页和页框大小固定，便于内存分配和管理。
内存保护：通过页表，可以为每个页设置访问权限，防止非法内存访问。

## 页面置换算法

当内存中的物理页框不足以满足所有进程的需求时，操作系统需要将某些页框中的内容换出到磁盘上，腾出空间给新的页框。这种情况下，页面置换算法决定了应该换出哪一页。

FIFO（First-In-First-Out）算法：最早加载的页最先被替换，简单但可能导致Belady’s Anomaly（更多的物理页框反而增加缺页率）。

LRU（Least Recently Used）算法：替换最近最少使用的页，通常效果较好，但实现复杂度较高。[LRU的实现方式](./LRU.md)。拓展：如何近似实现LRU以降低开销([Clock算法](./Clock算法.md))。
