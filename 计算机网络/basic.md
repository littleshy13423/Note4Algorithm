---
toc: true
---
# 基础知识

## OSI模型与TCP/IP模型

### OSI模型

物理层（Physical Layer）：负责比特流，物理设备，电压、电流等。

数据链路层（Data Link Layer）：使用mac地址，通过查表确定传输端口，one hop 数据传输，错误检测与纠正。常见协议有以太网（Ethernet）。

网络层（Network Layer）： 使用IP地址，IP地址具有hierarchicl的结构，负责路径选择和数据包的转发。

传输层（Transport Layer）： 提供端到端的通信服务，负责数据的分段、传输和重组，常见协议有TCP、UDP。

会话层（Session Layer）： 负责建立、管理和终止会话。会话层处理连接的建立、数据传输的同步和恢复。

表示层（Presentation Layer）： 理数据的格式转换、加密/解密、压缩/解压缩。处

应用层（Application Layer）： 为应用程序提供网络服务接口，常见协议有HTTP、FTP、SMTP。

### TCP/IP模型

TCP/IP模型是由四层组成的模型：

网络接口层（Link Layer）

互联网层（Internet Layer）

传输层（Transport Layer）

应用层（Application Layer）

## TCP与UDP

TCP（Transmission Control Protocol）： 面向连接的协议，提供可靠的字节流传输，通过三次握手建立连接，具有流量控制、拥塞控制和错误校验机制。适用于需要可靠传输的应用，如HTTP、FTP。

UDP（User Datagram Protocol）： 无连接的协议，提供不可靠的传输，不保证数据包的到达顺序和完整性。适用于对速度要求高但可以容忍丢包的应用，如视频流、在线游戏。

### TCP协议

#### 一、流量控制（Flow Control）

流量控制是TCP用于防止发送方发送数据过快，超过接收方处理能力的机制。它通过接收方向发送方反馈当前可接收的数据量，确保发送方不会超出接收方的处理能力。

滑动窗口（Sliding Window）：

TCP使用滑动窗口来实现流量控制。每个TCP连接都有一个接收窗口，大小由接收方决定。
接收方通过TCP报文中的Window Size字段告诉发送方自己可以接收的字节数。这是接收方当前缓冲区的剩余空间。
发送方根据这个窗口大小决定自己可以发送的最大数据量。如果接收方的窗口变小或为零，发送方必须停止发送，直到接收到更新的窗口大小。

零窗口探测（Zero Window Probe）：

当接收方的窗口大小变为零时，发送方会停止发送数据，但发送方会周期性地发送探测报文，询问接收方是否可以继续接收数据。一旦接收方的窗口大小恢复到非零，发送方就会继续传输数据。

#### 二、TCP拥塞控制（Congestion Control）

拥塞控制是TCP用于避免网络中因数据流量过大导致拥塞的机制。TCP的拥塞控制通过动态调整发送速率来避免网络拥塞。TCP的拥塞控制主要通过以下几个方法来实现：

慢启动（Slow Start）：

慢启动是拥塞控制的初始阶段，发送方开始时将拥塞窗口（Congestion Window, cwnd）设置为一个较小的值（通常是1个MSS，最大报文段大小）。
每次成功收到确认（ACK）后，发送方将拥塞窗口加倍（指数增长），直到达到慢启动阈值（ssthresh）或发生丢包。

拥塞避免（Congestion Avoidance）：

当拥塞窗口达到慢启动阈值后，TCP进入拥塞避免阶段。在这个阶段，拥塞窗口不再指数增长，而是线性增长，每个RTT（往返时间）内增加一个MSS的大小。
这样做是为了在接近网络带宽极限时，减缓增长速度，避免拥塞。

快速重传和快速恢复（Fast Retransmit & Fast Recovery）：

如果TCP检测到网络中存在丢包（通过重复ACK确认），它会触发快速重传，立即重传丢失的报文段，而无需等待超时。TCP进入快速恢复阶段，将拥塞窗口减半（乘以0.5），并将慢启动阈值设置为当前窗口的一半，从而减缓传输速率，避免进一步拥塞。
超时重传（超时没有接收到ACK），此时会触发超时重传，重传没有接收到ACK的报文段，拥塞窗口重新变为初始值（1MSS），ssthresh设置为当前窗口的一半。

滑动窗口、拥塞窗口与实际窗口的关系：

实际传输窗口大小取决于滑动窗口和拥塞窗口（由发送方根据网络状况动态调整）之间的较小值。

#### 三、TCP错误校验机制（Error Detection and Correction）

校验和（Checksum）：

每个TCP段都包含一个16位的校验和，用于检测传输过程中发生的位错误。发送方计算校验和并放入TCP头部，接收方收到数据后再计算一次校验和，如果接收到的校验和与计算出的不一致，说明数据发生了错误，接收方会丢弃该数据段。

序列号和ACK（Sequence Number & Acknowledgement）：

TCP使用序列号来确保数据的有序传输。每个数据段都有一个序列号，接收方根据序列号重新组装数据，并通过ACK确认已成功接收的数据段。
如果接收方发现某个数据段未按序到达，它会发送一个重复的ACK，提示发送方重新传输丢失的数据段。

#### 四、TCP三次握手和四次挥手

三次握手：
SYN： 客户端向服务器发送SYN（同步序列号）报文，表示请求建立连接。
SYN-ACK： 服务器收到SYN报文后，回应一个SYN-ACK（同步序列号+确认序列号）报文，表示同意连接并确认客户端的请求。
ACK： 客户端收到SYN-ACK报文后，再次发送ACK报文，表示确认连接已建立。
四次挥手：
FIN： 客户端发送FIN（终止连接）报文，表示请求关闭连接。
ACK： 服务器收到FIN报文后，发送ACK报文，表示确认收到关闭请求，但连接暂时不会关闭。
FIN： 服务器准备关闭连接时，发送FIN报文。
ACK： 客户端收到FIN报文后，发送ACK报文，确认关闭连接。

### UDP协议

UDP和TCP都是基于IP协议实现的协议，彼此并没有依赖关系（UDP是在TCP后被发明的）。

### UDP的常见应用场景

实时应用： 如视频流、音频通话和在线游戏，这些应用要求低延迟，对数据丢失有一定的容忍度。

简单查询服务： 如DNS（域名系统），通过UDP发送短小的数据请求和响应，快速完成域名解析。

网络广播和多播： UDP支持将数据包广播或多播到多个接收方，如IPTV和多播视频流等场景。

## DNS

DNS（Domain Name System，域名系统）是互联网的基础服务之一，负责将人类易读的域名（如www.google.com）转换为计算机可以理解的IP地址（如142.250.72.68）。访问www.google.com时，浏览器需要通过DNS解析将域名转换为IP地址，然后才能向该IP地址发送请求。

### 输入URL并检查本地缓存

当你在浏览器中输入www.google.com并按下回车后，首先会进行以下几步检查，试图在本地找到对应的IP地址：

浏览器首先检查自己的DNS缓存，看是否已经缓存了www.google.com的IP地址。如果浏览器缓存中没有找到匹配的记录，操作系统会检查自己的DNS缓存（通常称为DNS Resolver Cache）。如果找到匹配记录，则返回对应的IP地址。如果操作系统缓存也没有记录，操作系统会检查本地的hosts文件。这是一个用于手动定义域名和IP地址映射的文件。如果hosts文件中有www.google.com的映射，则返回相应的IP地址。

### 向本地DNS服务器发送查询

如果本地缓存和hosts文件都没有找到结果，操作系统会向配置的本地DNS服务器（通常是由ISP提供的DNS服务器）发送一个DNS查询请求。这个请求的目标是找到www.google.com的IP地址。

本地DNS服务器会根据请求进行DNS解析。DNS解析分为递归查询和迭代查询两种方式，通常结合使用。

### 返回IP地址并缓存

本地DNS服务器收到权威DNS服务器返回的IP地址后，会将该地址缓存一段时间以便下次查询时能够直接返回结果。本地DNS服务器将www.google.com的IP地址返回给客户端。

浏览器获得www.google.com的IP地址后，接下来会进行以下操作：

1. 建立TCP连接：
浏览器使用IP地址与目标服务器建立TCP连接。对于www.google.com，这个过程通常涉及到与Google的服务器建立连接。浏览器会执行TCP三次握手以建立可靠的连接。
2. 发送HTTP请求：
连接建立后，浏览器会向服务器发送HTTP请求（如GET / HTTP/1.1），请求网页内容。
3. 服务器响应：
服务器处理请求并返回响应内容，通常是HTML页面、CSS、JavaScript文件等资源。
4. 呈现网页内容
浏览器接收到服务器返回的HTML内容后，开始解析和渲染网页：

